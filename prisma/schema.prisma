generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
  output   = "../prisma/generated/client"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}


model tbl_agendamento {
  id                  Int                    @id @default(autoincrement())
  status              tbl_agendamento_status @default(Em_espera)
  data                DateTime               @db.Date
  hora                DateTime               @db.Time(0)
  id_usuario          Int?
  id_doacao           Int?
  id_hospital         Int?
  usuario             tbl_usuario?           @relation(fields: [id_usuario], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_agendamento_usuario")
  doacao              tbl_doacao?            @relation(fields: [id_doacao], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_agendamento_doacao")
  hospital            tbl_hospital?          @relation(fields: [id_hospital], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_agendamento_hospital")
  tbl_registro_doacao tbl_registro_doacao?

  @@index([id_doacao], map: "id_doacao")
  @@index([id_hospital], map: "id_hospital")
  @@index([id_usuario], map: "id_usuario")
}

model tbl_banco_sangue {
  id                 Int                @id @default(autoincrement())
  id_hospital        Int
  id_tipo_sanguineo  Int
  quantidade         Int                @default(0)
  tbl_hospital       tbl_hospital       @relation(fields: [id_hospital], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tbl_banco_sangue_ibfk_1")
  tbl_tipo_sanguineo tbl_tipo_sanguineo @relation(fields: [id_tipo_sanguineo], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tbl_banco_sangue_ibfk_2")

  @@index([id_hospital], map: "id_hospital")
  @@index([id_tipo_sanguineo], map: "id_tipo_sanguineo")
}

model tbl_certificado {
  id           Int          @id @default(autoincrement())
  titulo       String       @db.VarChar(50)
  organizacao  String       @db.VarChar(60)
  data_emissao DateTime     @db.Date
  id_usuario   Int?
  tbl_usuario  tbl_usuario? @relation(fields: [id_usuario], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tbl_certificado_ibfk_1")

  @@index([id_usuario], map: "id_usuario")
}

model tbl_doacao {
  id           Int               @id @default(autoincrement())
  data         DateTime          @db.Date
  observacao   String?           @db.Text
  foto         String?           @db.VarChar(255)
  agendamentos tbl_agendamento[]
}

model tbl_hospital {
  id                   Int                    @id @default(autoincrement())
  nome                 String                 @db.VarChar(70)
  email                String                 @unique(map: "email") @db.VarChar(100)
  senha                String                 @db.VarChar(255)
  cnpj                 String                 @unique(map: "cnpj") @db.VarChar(20)
  crm                  String                 @db.VarChar(255)
  cep                  String                 @db.VarChar(10)
  telefone             String                 @db.VarChar(15)
  capacidade_maxima    Int                    @default(10)
  convenios            String                 @db.VarChar(255)
  horario_abertura     DateTime               @default(dbgenerated("'08:00:00'")) @db.Time(0)
  horario_fechamento   DateTime               @default(dbgenerated("'18:00:00'")) @db.Time(0)
  foto                 String                 @db.VarChar(255)
  complemento          String?                @db.VarChar(255)
  agendamentos         tbl_agendamento[]
  tbl_banco_sangue     tbl_banco_sangue[]
  tbl_registro_doacao  tbl_registro_doacao[]
}

model tbl_sexo {
  id       Int           @id @default(autoincrement())
  sexo     String        @db.VarChar(15)
  usuarios tbl_usuario[]
}

model tbl_telefone {
  id          Int          @id @default(autoincrement())
  tipo        String       @db.VarChar(30)
  numero      String       @db.VarChar(15)
  id_usuario  Int?
  tbl_usuario tbl_usuario? @relation(fields: [id_usuario], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tbl_telefone_ibfk_1")

  @@index([id_usuario], map: "id_usuario")
}

model tbl_tipo_sanguineo {
  id               Int                @id @default(autoincrement())
  tipo             String             @unique(map: "tipo") @db.VarChar(5)
  tbl_banco_sangue tbl_banco_sangue[]
  tbl_usuario      tbl_usuario[]
}

model tbl_usuario {
  id                    Int                     @id @default(autoincrement())
  nome                  String                  @db.VarChar(70)
  email                 String                  @unique(map: "email") @db.VarChar(100)
  senha_hash            String                  @db.VarChar(255)
  cpf                   String?                 @unique(map: "cpf") @db.VarChar(15)
  cep                   String?                 @db.VarChar(10)
  logradouro            String?                 @db.VarChar(150)
  bairro                String?                 @db.VarChar(100)
  localidade            String?                 @db.VarChar(100)
  uf                    String?                 @db.VarChar(2)
  numero                String?                 @db.VarChar(20)
  data_nascimento       DateTime?               @db.Date
  foto_perfil           String?                 @db.VarChar(255)
  id_tipo_sanguineo     Int?
  id_sexo               Int?
  data_criacao          DateTime?               @default(now()) @db.Timestamp(0)
  data_atualizacao      DateTime?               @default(now()) @db.Timestamp(0)
  agendamentos          tbl_agendamento[]
  tbl_certificado       tbl_certificado[]
  tbl_recuperacao_senha tbl_recuperacao_senha[]
  tbl_telefone          tbl_telefone[]
  tbl_registro_doacao   tbl_registro_doacao[]
  tbl_tipo_sanguineo    tbl_tipo_sanguineo?     @relation(fields: [id_tipo_sanguineo], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tbl_usuario_ibfk_1")
  sexo                  tbl_sexo?               @relation(fields: [id_sexo], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_usuario_sexo")

  @@index([id_sexo], map: "id_sexo")
  @@index([id_tipo_sanguineo], map: "id_tipo_sanguineo")
}

model tbl_recuperacao_senha {
  id          Int         @id @default(autoincrement())
  id_usuario  Int
  codigo      String      @db.VarChar(50)
  criado_em   DateTime?   @default(now()) @db.Timestamp(0)
  usado       Boolean?    @default(false)
  tbl_usuario tbl_usuario @relation(fields: [id_usuario], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tbl_recuperacao_senha_ibfk_1")

  @@index([id_usuario], map: "id_usuario")
}

model tbl_registro_doacao {
  id                Int              @id @default(autoincrement())
  id_agendamento    Int              @unique(map: "id_agendamento")
  id_usuario        Int
  id_hospital       Int
  data_doacao       DateTime         @db.Date
  local_doacao      String           @db.VarChar(255)
  observacao        String?          @db.Text
  foto_comprovante  String?          @db.VarChar(500)
  data_registro     DateTime?        @default(now()) @db.Timestamp(0)
  tbl_agendamento   tbl_agendamento  @relation(fields: [id_agendamento], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tbl_registro_doacao_ibfk_1")
  tbl_usuario       tbl_usuario      @relation(fields: [id_usuario], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tbl_registro_doacao_ibfk_2")
  tbl_hospital      tbl_hospital     @relation(fields: [id_hospital], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "tbl_registro_doacao_ibfk_3")

  @@index([id_usuario], map: "id_usuario")
  @@index([id_hospital], map: "id_hospital")
}

enum tbl_agendamento_status {
  Agendado
  Em_espera @map("Em espera")
  Conclu_do @map("Conclu√≠do")
  Cancelado
}
